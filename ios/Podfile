platform :ios, '15.0'

# The pod_helper.rb is generated by flutter pub get on the Mac runner.
# It contains the flutter_install_all_ios_pods and flutter_additional_ios_build_settings functions.
pod_helper_path = File.expand_path('../.flutter-plugins-dependencies/ios/pod_helper.rb', __FILE__)
if File.exist?(pod_helper_path)
  require pod_helper_path
else
  # Stub functions so the Podfile doesn't crash before flutter pub get
  def flutter_install_all_ios_pods(path); end
  def flutter_additional_ios_build_settings(target); end
end

target 'Runner' do
  use_frameworks!
  use_modular_headers!

  flutter_install_all_ios_pods File.dirname(File.realpath(__FILE__))
end

post_install do |installer|
  installer.pods_project.targets.each do |target|
    # Attempt to call flutter settings if available
    begin
      flutter_additional_ios_build_settings(target)
    rescue
    end
    
    target.build_configurations.each do |config|
      config.build_settings['IPHONEOS_DEPLOYMENT_TARGET'] = '15.0'
      config.build_settings['SWIFT_VERSION'] = '5.0'
    end
  end
end
